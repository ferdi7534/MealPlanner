const COMMON_ALLERGIES = [
  "Gluten", "Lactose", "Arachides", "Fruits à coque",
  "Œufs", "Poisson", "Crustacés", "Soja", "Sésame", "Moutarde"
];

let selectedAllergies = [];

function renderAllergiesSelector() {
  const container = document.getElementById("allergies-selector");
  container.innerHTML = "";

  // Allergies communes
  const commonDiv = document.createElement("div");
  commonDiv.className = "allergy-badges";

  COMMON_ALLERGIES.forEach(allergy => {
    const badge = document.createElement("div");
    const selected = selectedAllergies.includes(allergy);

    badge.className = `badge ${selected ? "badge-selected" : "badge-outline"}`;
    badge.innerHTML = selected ? `${allergy} <span class="badge-x">✕</span>` : allergy;

    badge.onclick = () => toggleAllergy(allergy);
    commonDiv.appendChild(badge);
  });

  container.appendChild(commonDiv);

  // Input allergie personnalisée
  const inputRow = document.createElement("div");
  inputRow.className = "allergy-input-row";
  inputRow.innerHTML = `
    <input id="custom-allergy" class="allergy-input" placeholder="Autre allergie..." />
    <button id="add-allergy" class="add-btn">+</button>
  `;
  container.appendChild(inputRow);

  const input = inputRow.querySelector("#custom-allergy");
  const btn = inputRow.querySelector("#add-allergy");

  btn.onclick = () => addCustomAllergy(input.value);
  input.onkeypress = e => e.key === "Enter" && addCustomAllergy(input.value);

  // Allergies personnalisées
  const custom = selectedAllergies.filter(a => !COMMON_ALLERGIES.includes(a));
  if (custom.length) {
    const customDiv = document.createElement("div");
    customDiv.className = "allergy-badges";
    customDiv.style.marginTop = "10px";

    custom.forEach(allergy => {
      const badge = document.createElement("div");
      badge.className = "badge badge-selected";
      badge.innerHTML = `${allergy} <span class="badge-x">✕</span>`;
      badge.onclick = () => toggleAllergy(allergy);
      customDiv.appendChild(badge);
    });

    container.appendChild(customDiv);
  }
}

function toggleAllergy(allergy) {
  if (selectedAllergies.includes(allergy)) {
    selectedAllergies = selectedAllergies.filter(a => a !== allergy);
  } else {
    selectedAllergies.push(allergy);
  }
  renderAllergiesSelector();
}

function addCustomAllergy(value) {
  const allergy = value.trim();
  if (allergy && !selectedAllergies.includes(allergy)) {
    selectedAllergies.push(allergy);
    renderAllergiesSelector();
  }
renderAllergiesSelector();
}
console.log(selectedAllergies);
